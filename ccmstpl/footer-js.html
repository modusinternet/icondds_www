/* Register a service worker. */
if(navigator.serviceWorker){
	window.addEventListener('load',() => {
		navigator.serviceWorker
		.register('/sw.js')
		.then(console.log('[ServiceWorker] Registered Successfully'))
		.catch(err => console.log(`[ServiceWorker] Error: ${err}`));
	});
} else {
	console.log('Service Worker not supported.');
}


let deferredPrompt;

const divInstall = document.getElementById('installContainer');
const butInstall = document.getElementById('butInstall');

console.log('before beforeinstallprompt');

window.addEventListener('beforeinstallprompt',(e) => {

console.log('inside beforeinstallprompt');

	console.log('beforeinstallprompt','beforeinstallprompt', e);
	// Prevent Chrome 76 and later from showing the mini-infobar
	e.preventDefault();
	// Stash the event so it can be triggered later.
	//window.deferredPrompt = e;
	deferredPrompt = e;
	// Remove the 'hidden' class from the install button container
	divInstall.classList.toggle('hidden',false);

	butInstall.addEventListener('click',(e)=>{
		// hide our user interface that shows our A2HS button
		//btnAdd.style.display = 'none';
		divInstall.classList.toggle('hidden',true);
		// Show the prompt
		deferredPrompt.prompt();
		// Wait for the user to respond to the prompt
		deferredPrompt.userChoice.then((choiceResult)=>{
			if (choiceResult.outcome === 'accepted') {
				console.log('User accepted the A2HS prompt');
			} else {
				console.log('User dismissed the A2HS prompt');
			}
			deferredPrompt = null;
		});
	});
});

window.addEventListener('appinstalled', (event) => {
	console.log('appinstalled', 'appinstalled', event);
});



/* This feature helps clear out a cached cookies so that a new one can be written in place when changing your language.	You can choose to not use if you wish, it was just added to help make sure the example templates would do as we wished them to as written.	Your templates probably will not require such code, all links should contain the full language snippit in them to help drive the templates to the correct language content.
ie: { CCMS_LIB:_default.php;FUNC:ccms_lng}
     ^-- remove this space.
lcu = language cookie update */
function ccms_lcu(lng) {
		document.cookie = "ccms_lng={CCMS_LIB:_default.php;FUNC:ccms_lng}; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/";
		/* insert a new cookie and get it in the cache, just incase we're dealing with the home page. */
		var d = new Date();
		d.setTime(d.getTime() + (365*24*60*60*1000));
		var expires = "expires=" + d.toUTCString();
		document.cookie = "ccms_lng=" + lng + "; " + expires + "; path=/";
		return;
}
